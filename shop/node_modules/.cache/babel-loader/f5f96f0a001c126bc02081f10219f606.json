{"ast":null,"code":"import _slicedToArray from\"/var/www/html/check/javascript-shop/client.v1/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{Container,Row,Col,Spinner}from'react-bootstrap';import CategoryBar from'../components/CategoryBar.js';import BrandBar from'../components/BrandBar.js';import ProductList from'../components/ProductList.js';import{useContext,useEffect,useState}from'react';import{AppContext}from'../components/AppContext.js';import{fetchCategories,fetchBrands,fetchAllProducts}from'../http/catalogAPI.js';import{observer}from'mobx-react-lite';import{useLocation,useSearchParams}from'react-router-dom';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var getSearchParams=function getSearchParams(searchParams){var category=searchParams.get('category');if(category&&/[1-9][0-9]*/.test(category)){category=parseInt(category);}var brand=searchParams.get('brand');if(brand&&/[1-9][0-9]*/.test(brand)){brand=parseInt(brand);}var page=searchParams.get('page');if(page&&/[1-9][0-9]*/.test(page)){page=parseInt(page);}return{category:category,brand:brand,page:page};};var Shop=observer(function(){var _useContext=useContext(AppContext),catalog=_useContext.catalog;var _useState=useState(true),_useState2=_slicedToArray(_useState,2),categoriesFetching=_useState2[0],setCategoriesFetching=_useState2[1];var _useState3=useState(true),_useState4=_slicedToArray(_useState3,2),brandsFetching=_useState4[0],setBrandsFetching=_useState4[1];var _useState5=useState(true),_useState6=_slicedToArray(_useState5,2),productsFetching=_useState6[0],setProductsFetching=_useState6[1];var location=useLocation();var _useSearchParams=useSearchParams(),_useSearchParams2=_slicedToArray(_useSearchParams,1),searchParams=_useSearchParams2[0];useEffect(function(){fetchCategories().then(function(data){return catalog.categories=data;}).finally(function(){return setCategoriesFetching(false);});fetchBrands().then(function(data){return catalog.brands=data;}).finally(function(){return setBrandsFetching(false);});var _getSearchParams=getSearchParams(searchParams),category=_getSearchParams.category,brand=_getSearchParams.brand,page=_getSearchParams.page;catalog.category=category;catalog.brand=brand;catalog.page=page!==null&&page!==void 0?page:1;fetchAllProducts(catalog.category,catalog.brand,catalog.page,catalog.limit).then(function(data){catalog.products=data.rows;catalog.count=data.count;}).finally(function(){return setProductsFetching(false);});// eslint-disable-next-line\n},[]);// При каждом клике на категорию, бренд или номер страницы — мы добавляем элемент в историю\n// браузера, ссылки в истории имеют вид /?page=1, /?page=2, /?page=3. При нажатии кнопки \n// «Назад» браузера — мы отслеживаем изменение GET-параметров и изменяем состояние хранилища.\nuseEffect(function(){var _getSearchParams2=getSearchParams(searchParams),category=_getSearchParams2.category,brand=_getSearchParams2.brand,page=_getSearchParams2.page;if(category||brand||page){if(category!==catalog.category){catalog.category=category;}if(brand!==catalog.brand){catalog.brand=brand;}if(page!==catalog.page){catalog.page=page!==null&&page!==void 0?page:1;}}else{catalog.category=null;catalog.brand=null;catalog.page=1;}// eslint-disable-next-line\n},[location.search]);// при клике на категорию, бренд, номер страницы или при нажатии кнопки  «Назад» \n// браузера — получам с сервера список товаров, потому что это уже другой список\nuseEffect(function(){setProductsFetching(true);fetchAllProducts(catalog.category,catalog.brand,catalog.page,catalog.limit).then(function(data){catalog.products=data.rows;catalog.count=data.count;}).finally(function(){return setProductsFetching(false);});// eslint-disable-next-line\n},[catalog.category,catalog.brand,catalog.page]);return/*#__PURE__*/_jsx(Container,{children:/*#__PURE__*/_jsxs(Row,{className:\"mt-2\",children:[/*#__PURE__*/_jsx(Col,{md:3,className:\"mb-3\",children:categoriesFetching?/*#__PURE__*/_jsx(Spinner,{animation:\"border\"}):/*#__PURE__*/_jsx(CategoryBar,{})}),/*#__PURE__*/_jsxs(Col,{md:9,children:[/*#__PURE__*/_jsx(\"div\",{children:brandsFetching?/*#__PURE__*/_jsx(Spinner,{animation:\"border\"}):/*#__PURE__*/_jsx(BrandBar,{})}),/*#__PURE__*/_jsx(\"div\",{children:productsFetching?/*#__PURE__*/_jsx(Spinner,{animation:\"border\"}):/*#__PURE__*/_jsx(ProductList,{})})]})]})});});export default Shop;","map":{"version":3,"sources":["/var/www/html/check/javascript-shop/client.v1/src/pages/Shop.js"],"names":["Container","Row","Col","Spinner","CategoryBar","BrandBar","ProductList","useContext","useEffect","useState","AppContext","fetchCategories","fetchBrands","fetchAllProducts","observer","useLocation","useSearchParams","getSearchParams","searchParams","category","get","test","parseInt","brand","page","Shop","catalog","categoriesFetching","setCategoriesFetching","brandsFetching","setBrandsFetching","productsFetching","setProductsFetching","location","then","data","categories","finally","brands","limit","products","rows","count","search"],"mappings":"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","sourcesContent":["import { Container, Row, Col, Spinner } from 'react-bootstrap'\nimport CategoryBar from '../components/CategoryBar.js'\nimport BrandBar from '../components/BrandBar.js'\nimport ProductList from '../components/ProductList.js'\nimport { useContext, useEffect, useState } from 'react'\nimport { AppContext } from '../components/AppContext.js'\nimport { fetchCategories, fetchBrands, fetchAllProducts } from '../http/catalogAPI.js'\nimport { observer } from 'mobx-react-lite'\nimport { useLocation, useSearchParams } from 'react-router-dom'\n\nconst getSearchParams = (searchParams) => {\n    let category = searchParams.get('category')\n    if (category && /[1-9][0-9]*/.test(category)) {\n        category = parseInt(category)\n    }\n    let brand = searchParams.get('brand')\n    if (brand && /[1-9][0-9]*/.test(brand)) {\n        brand = parseInt(brand)\n    }\n    let page = searchParams.get('page')\n    if (page && /[1-9][0-9]*/.test(page)) {\n        page = parseInt(page)\n    }\n    return {category, brand, page}\n}\n\nconst Shop = observer(() => {\n    const { catalog } = useContext(AppContext)\n\n    const [categoriesFetching, setCategoriesFetching] = useState(true)\n    const [brandsFetching, setBrandsFetching] = useState(true)\n    const [productsFetching, setProductsFetching] = useState(true)\n\n    const location = useLocation()\n    const [searchParams] = useSearchParams()\n\n    useEffect(() => {\n        fetchCategories()\n            .then(data => catalog.categories = data)\n            .finally(() => setCategoriesFetching(false))\n\n        fetchBrands()\n            .then(data => catalog.brands = data)\n            .finally(() => setBrandsFetching(false))\n\n        const {category, brand, page} = getSearchParams(searchParams)\n        catalog.category = category\n        catalog.brand = brand\n        catalog.page = page ?? 1\n\n        fetchAllProducts(catalog.category, catalog.brand, catalog.page, catalog.limit)\n            .then(data => {\n                catalog.products = data.rows\n                catalog.count = data.count\n            })\n            .finally(() => setProductsFetching(false))\n        // eslint-disable-next-line\n    }, [])\n\n    // При каждом клике на категорию, бренд или номер страницы — мы добавляем элемент в историю\n    // браузера, ссылки в истории имеют вид /?page=1, /?page=2, /?page=3. При нажатии кнопки \n    // «Назад» браузера — мы отслеживаем изменение GET-параметров и изменяем состояние хранилища.\n    useEffect(() => {\n        const {category, brand, page} = getSearchParams(searchParams)\n\n        if (category || brand || page) {\n            if (category !== catalog.category) {\n                catalog.category = category\n            }\n            if (brand !== catalog.brand) {\n                catalog.brand = brand\n            }\n            if (page !== catalog.page) {\n                catalog.page = page ?? 1\n            }\n        } else  {\n            catalog.category = null\n            catalog.brand = null\n            catalog.page = 1\n        }\n        // eslint-disable-next-line\n    }, [location.search])\n\n    // при клике на категорию, бренд, номер страницы или при нажатии кнопки  «Назад» \n    // браузера — получам с сервера список товаров, потому что это уже другой список\n    useEffect(() => {\n        setProductsFetching(true)\n        fetchAllProducts(catalog.category, catalog.brand, catalog.page, catalog.limit)\n            .then(data => {\n                catalog.products = data.rows\n                catalog.count = data.count\n            })\n            .finally(() => setProductsFetching(false))\n        // eslint-disable-next-line\n    }, [catalog.category, catalog.brand, catalog.page])\n\n    return (\n        <Container>\n            <Row className=\"mt-2\">\n                <Col md={3} className=\"mb-3\">\n                    {categoriesFetching ? (\n                        <Spinner animation=\"border\" />\n                    ) : (\n                        <CategoryBar />\n                    )}\n                </Col>\n                <Col md={9}>\n                    <div>\n                        {brandsFetching ? (\n                            <Spinner animation=\"border\" />\n                        ) : (\n                            <BrandBar />\n                        )}\n                    </div>\n                    <div>\n                        {productsFetching ? (\n                            <Spinner animation=\"border\" />\n                        ) : (\n                            <ProductList />\n                        )}\n                    </div>\n                </Col>\n            </Row>\n        </Container>\n    )\n})\n\nexport default Shop\n"]},"metadata":{},"sourceType":"module"}