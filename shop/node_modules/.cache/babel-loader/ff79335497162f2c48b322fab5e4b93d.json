{"ast":null,"code":"import _slicedToArray from\"/var/www/html/check/javascript-shop/client.v1/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{useState,useEffect}from'react';import{fetchAllProducts,deleteProduct}from'../http/catalogAPI.js';import{Button,Container,Spinner,Table,Pagination}from'react-bootstrap';import CreateProduct from'../components/CreateProduct.js';import UpdateProduct from'../components/UpdateProduct.js';// количество товаров на страницу\nimport{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var ADMIN_PER_PAGE=6;var AdminProducts=function AdminProducts(){var _useState=useState([]),_useState2=_slicedToArray(_useState,2),products=_useState2[0],setProducts=_useState2[1];// список загруженных товаров\nvar _useState3=useState(true),_useState4=_slicedToArray(_useState3,2),fetching=_useState4[0],setFetching=_useState4[1];// загрузка списка товаров с сервера\nvar _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),createShow=_useState6[0],setCreateShow=_useState6[1];// модальное окно создания товара\nvar _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),updateShow=_useState8[0],setUpdateShow=_useState8[1];// модальное окно редактирования\n// для обновления списка после добавления, редактирования, удаления — изменяем состояние\nvar _useState9=useState(false),_useState10=_slicedToArray(_useState9,2),change=_useState10[0],setChange=_useState10[1];// id товара, который будем редактировать — для передачи в <UpdateProduct id={…} />\nvar _useState11=useState(null),_useState12=_slicedToArray(_useState11,2),product=_useState12[0],setProduct=_useState12[1];// текущая страница списка товаров\nvar _useState13=useState(1),_useState14=_slicedToArray(_useState13,2),currentPage=_useState14[0],setCurrentPage=_useState14[1];// сколько всего страниц списка товаров\nvar _useState15=useState(1),_useState16=_slicedToArray(_useState15,2),totalPages=_useState16[0],setTotalPages=_useState16[1];// обработчик клика по номеру страницы\nvar handlePageClick=function handlePageClick(page){setCurrentPage(page);setFetching(true);};// содержимое компонента <Pagination>\nvar pages=[];var _loop=function _loop(page){pages.push(/*#__PURE__*/_jsx(Pagination.Item,{active:page===currentPage,activeLabel:\"\",onClick:function onClick(){return handlePageClick(page);},children:page},page));};for(var page=1;page<=totalPages;page++){_loop(page);}var handleUpdateClick=function handleUpdateClick(id){setProduct(id);setUpdateShow(true);};var handleDeleteClick=function handleDeleteClick(id){deleteProduct(id).then(function(data){// если это последняя страница и мы удаляем на ней единственный\n// оставшийся товар — то надо перейти к предыдущей странице\nif(totalPages>1&&products.length===1&&currentPage===totalPages){setCurrentPage(currentPage-1);}else{setChange(!change);}alert(\"\\u0422\\u043E\\u0432\\u0430\\u0440 \\xAB\".concat(data.name,\"\\xBB \\u0443\\u0434\\u0430\\u043B\\u0435\\u043D\"));}).catch(function(error){return alert(error.response.data.message);});};useEffect(function(){fetchAllProducts(null,null,currentPage,ADMIN_PER_PAGE).then(function(data){setProducts(data.rows);setTotalPages(Math.ceil(data.count/ADMIN_PER_PAGE));}).finally(function(){return setFetching(false);});},[change,currentPage]);if(fetching){return/*#__PURE__*/_jsx(Spinner,{animation:\"border\"});}return/*#__PURE__*/_jsxs(Container,{children:[/*#__PURE__*/_jsx(\"h1\",{children:\"\\u0422\\u043E\\u0432\\u0430\\u0440\\u044B\"}),/*#__PURE__*/_jsx(Button,{onClick:function onClick(){return setCreateShow(true);},children:\"\\u0421\\u043E\\u0437\\u0434\\u0430\\u0442\\u044C \\u0442\\u043E\\u0432\\u0430\\u0440\"}),/*#__PURE__*/_jsx(CreateProduct,{show:createShow,setShow:setCreateShow,setChange:setChange}),/*#__PURE__*/_jsx(UpdateProduct,{id:product,show:updateShow,setShow:setUpdateShow,setChange:setChange}),products.length>0?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(Table,{bordered:true,hover:true,size:\"sm\",className:\"mt-3\",children:[/*#__PURE__*/_jsx(\"thead\",{children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{children:\"\\u041D\\u0430\\u0437\\u0432\\u0430\\u043D\\u0438\\u0435\"}),/*#__PURE__*/_jsx(\"th\",{children:\"\\u0424\\u043E\\u0442\\u043E\"}),/*#__PURE__*/_jsx(\"th\",{children:\"\\u041A\\u0430\\u0442\\u0435\\u0433\\u043E\\u0440\\u0438\\u044F\"}),/*#__PURE__*/_jsx(\"th\",{children:\"\\u0411\\u0440\\u0435\\u043D\\u0434\"}),/*#__PURE__*/_jsx(\"th\",{children:\"\\u0426\\u0435\\u043D\\u0430\"}),/*#__PURE__*/_jsx(\"th\",{children:\"\\u0420\\u0435\\u0434\\u0430\\u043A\\u0442\\u0438\\u0440\\u043E\\u0432\\u0430\\u0442\\u044C\"}),/*#__PURE__*/_jsx(\"th\",{children:\"\\u0423\\u0434\\u0430\\u043B\\u0438\\u0442\\u044C\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{children:products.map(function(item){var _item$category,_item$brand;return/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{children:item.name}),/*#__PURE__*/_jsx(\"td\",{children:item.image&&/*#__PURE__*/_jsx(\"a\",{href:process.env.REACT_APP_IMG_URL+item.image,target:\"_blank\",children:\"\\u0444\\u043E\\u0442\\u043E\"})}),/*#__PURE__*/_jsx(\"td\",{children:((_item$category=item.category)===null||_item$category===void 0?void 0:_item$category.name)||'NULL'}),/*#__PURE__*/_jsx(\"td\",{children:((_item$brand=item.brand)===null||_item$brand===void 0?void 0:_item$brand.name)||'NULL'}),/*#__PURE__*/_jsx(\"td\",{children:item.price}),/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsx(Button,{variant:\"success\",size:\"sm\",onClick:function onClick(){return handleUpdateClick(item.id);},children:\"\\u0420\\u0435\\u0434\\u0430\\u043A\\u0442\\u0438\\u0440\\u043E\\u0432\\u0430\\u0442\\u044C\"})}),/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsx(Button,{variant:\"danger\",size:\"sm\",onClick:function onClick(){return handleDeleteClick(item.id);},children:\"\\u0423\\u0434\\u0430\\u043B\\u0438\\u0442\\u044C\"})})]},item.id);})})]}),totalPages>1&&/*#__PURE__*/_jsx(Pagination,{children:pages})]}):/*#__PURE__*/_jsx(\"p\",{children:\"\\u0421\\u043F\\u0438\\u0441\\u043E\\u043A \\u0442\\u043E\\u0432\\u0430\\u0440\\u043E\\u0432 \\u043F\\u0443\\u0441\\u0442\\u043E\\u0439\"})]});};export default AdminProducts;","map":{"version":3,"sources":["/var/www/html/check/javascript-shop/client.v1/src/pages/AdminProducts.js"],"names":["useState","useEffect","fetchAllProducts","deleteProduct","Button","Container","Spinner","Table","Pagination","CreateProduct","UpdateProduct","ADMIN_PER_PAGE","AdminProducts","products","setProducts","fetching","setFetching","createShow","setCreateShow","updateShow","setUpdateShow","change","setChange","product","setProduct","currentPage","setCurrentPage","totalPages","setTotalPages","handlePageClick","page","pages","push","handleUpdateClick","id","handleDeleteClick","then","data","length","alert","name","catch","error","response","message","rows","Math","ceil","count","finally","map","item","image","process","env","REACT_APP_IMG_URL","category","brand","price"],"mappings":"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","sourcesContent":["import { useState, useEffect } from 'react'\nimport { fetchAllProducts, deleteProduct } from '../http/catalogAPI.js'\nimport { Button, Container, Spinner, Table, Pagination } from 'react-bootstrap'\nimport CreateProduct from '../components/CreateProduct.js'\nimport UpdateProduct from '../components/UpdateProduct.js'\n\n// количество товаров на страницу\nconst ADMIN_PER_PAGE = 6\n\nconst AdminProducts = () => {\n    const [products, setProducts] = useState([]) // список загруженных товаров\n    const [fetching, setFetching] = useState(true) // загрузка списка товаров с сервера\n    const [createShow, setCreateShow] = useState(false) // модальное окно создания товара\n    const [updateShow, setUpdateShow] = useState(false) // модальное окно редактирования\n    // для обновления списка после добавления, редактирования, удаления — изменяем состояние\n    const [change, setChange] = useState(false)\n    // id товара, который будем редактировать — для передачи в <UpdateProduct id={…} />\n    const [product, setProduct] = useState(null)\n\n    // текущая страница списка товаров\n    const [currentPage, setCurrentPage] = useState(1)\n    // сколько всего страниц списка товаров\n    const [totalPages, setTotalPages] = useState(1)\n\n    // обработчик клика по номеру страницы\n    const handlePageClick = (page) => {\n        setCurrentPage(page)\n        setFetching(true)\n    }\n\n    // содержимое компонента <Pagination>\n    const pages = []\n    for (let page = 1; page <= totalPages; page++) {\n        pages.push(\n            <Pagination.Item\n                key={page}\n                active={page === currentPage}\n                activeLabel=\"\"\n                onClick={() => handlePageClick(page)}\n            >\n                {page}\n            </Pagination.Item>\n        )\n    }\n\n    const handleUpdateClick = (id) => {\n        setProduct(id)\n        setUpdateShow(true)\n    }\n\n    const handleDeleteClick = (id) => {\n        deleteProduct(id)\n            .then(\n                data => {\n                    // если это последняя страница и мы удаляем на ней единственный\n                    // оставшийся товар — то надо перейти к предыдущей странице\n                    if (totalPages > 1 && products.length === 1 && currentPage === totalPages) {\n                        setCurrentPage(currentPage - 1)\n                    } else {\n                        setChange(!change)\n                    }\n                    alert(`Товар «${data.name}» удален`)\n                }\n            )\n            .catch(\n                error => alert(error.response.data.message)\n            )\n    }\n\n    useEffect(() => {\n        fetchAllProducts(null, null, currentPage, ADMIN_PER_PAGE)\n            .then(\n                data => {\n                    setProducts(data.rows)\n                    setTotalPages(Math.ceil(data.count / ADMIN_PER_PAGE))\n                }\n            )\n            .finally(\n                () => setFetching(false)\n            )\n    }, [change, currentPage])\n\n    if (fetching) {\n        return <Spinner animation=\"border\" />\n    }\n\n    return (\n        <Container>\n            <h1>Товары</h1>\n            <Button onClick={() => setCreateShow(true)}>Создать товар</Button>\n            <CreateProduct show={createShow} setShow={setCreateShow} setChange={setChange} />\n            <UpdateProduct id={product} show={updateShow} setShow={setUpdateShow} setChange={setChange} />\n            {products.length > 0 ? (\n                <>\n                    <Table bordered hover size=\"sm\" className=\"mt-3\">\n                    <thead>\n                        <tr>\n                            <th>Название</th>\n                            <th>Фото</th>\n                            <th>Категория</th>\n                            <th>Бренд</th>\n                            <th>Цена</th>\n                            <th>Редактировать</th>\n                            <th>Удалить</th>\n                        </tr>\n                    </thead>\n                    <tbody>\n                        {products.map(item => \n                            <tr key={item.id}>\n                                <td>{item.name}</td>\n                                <td>\n                                    {item.image &&\n                                    <a href={process.env.REACT_APP_IMG_URL + item.image} target=\"_blank\">фото</a>}\n                                </td>\n                                <td>{item.category?.name || 'NULL'}</td>\n                                <td>{item.brand?.name || 'NULL'}</td>\n                                <td>{item.price}</td>\n                                <td>\n                                    <Button variant=\"success\" size=\"sm\" onClick={() => handleUpdateClick(item.id)}>\n                                        Редактировать\n                                    </Button>\n                                </td>\n                                <td>\n                                    <Button variant=\"danger\" size=\"sm\" onClick={() => handleDeleteClick(item.id)}>\n                                        Удалить\n                                    </Button>\n                                </td>\n                            </tr>\n                        )}\n                    </tbody>\n                    </Table>\n                    {totalPages > 1 && <Pagination>{pages}</Pagination>}\n                </>\n            ) : (\n                <p>Список товаров пустой</p>\n            )}\n        </Container>\n    )\n}\n\nexport default AdminProducts"]},"metadata":{},"sourceType":"module"}